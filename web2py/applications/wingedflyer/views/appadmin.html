{{extend 'layout.html'}}

<script>
jQuery(document).ready(function(){
    jQuery("table.sortable tbody tr").mouseover(function() {
        jQuery(this).addClass("highlight");
    }).mouseout(function() {
        jQuery(this).removeClass("highlight");
    });
    jQuery('table.sortable tbody tr:odd').addClass('odd');
    jQuery('table.sortable tbody tr:even').addClass('even');
});
</script>

<div class="row">
  <div class="col-md-12">

  {{if request.function=='index':}}
    <h2>{{=T("Database Administration")}}</h2>
    
    <div class="alert alert-info">
      <strong>{{=T("Responsible Management:")}}</strong> 
      {{=T("Manage entities (MFIs, Coaching Orgs, etc.) and their operational contexts.")}}
    </div>

    <div class="my-3">
      <a class="btn btn-success btn-lg" href="{{=URL('responsiblelist')}}">
        <i class="glyphicon glyphicon-list"></i> {{=T("View All Responsibles")}}
      </a>
      <a class="btn btn-primary btn-lg" href="{{=URL('responsiblecreate')}}">
        <i class="glyphicon glyphicon-plus"></i> {{=T("Add New Responsible")}}
      </a>
      <a class="btn btn-info btn-lg" href="{{=URL('manage_language')}}">
        <i class="glyphicon glyphicon-globe"></i> {{=T("Manage Language Mappings")}}
      </a>
    </div>

    <hr/>

    <h3>{{=T("Available Tables")}}</h3>
    {{elif request.function=='responsiblelist':}}
    <h2>{{=T("Responsible Entities")}}</h2>

    {{if 'error' in globals() and error:}}
      <div class="alert alert-danger">{{=error}}</div>
    {{elif rows:}}
      <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
          <thead class="thead-dark">
            <tr>
              <th>{{=T("Name")}}</th>
              <th>{{=T("Context")}}</th>
              <th>{{=T("Username")}}</th>
              <th>{{=T("Country")}}</th>
              <th>{{=T("Email")}}</th>
              <th>{{=T("Limit")}}</th>
              <th>{{=T("Created On")}}</th>
              <th style="width: 120px;">{{=T("Actions")}}</th>
            </tr>
          </thead>
          <tbody>
            {{for row in rows:}}
              <tr>
                <td><strong>{{=row.responsible.name}}</strong></td>
                <td><span class="label label-info">{{=row.context.display_name}}</span></td>
                <td><code>{{=row.responsible.username}}</code></td>
                <td>{{=row.responsible.country or T('N/A')}}</td>
                <td>{{=row.responsible.email or T('N/A')}}</td>
                <td><span class="badge">{{=row.responsible.participant_limit}}</span></td>
                <td>{{=row.responsible.created_on.strftime('%Y-%m-%d') if row.responsible.created_on else T('N/A')}}</td>
                <td>
                  <a class="btn btn-sm btn-primary" href="{{=URL('responsibleedit', args=[row.responsible.id])}}">
                    <i class="glyphicon glyphicon-edit"></i> {{=T("Edit")}}
                  </a>
                </td>
              </tr>
            {{pass}}
          </tbody>
        </table>
      </div>
    {{pass}}

    <div class="my-3">
      <a class="btn btn-success btn-lg" href="{{=URL('responsiblecreate')}}">
        <i class="glyphicon glyphicon-plus"></i> {{=T("Add New Responsible")}}
      </a>
      <a class="btn btn-secondary" href="{{=URL('index')}}">
        <i class="glyphicon glyphicon-arrow-left"></i> {{=T("Back to Admin")}}
      </a>
    </div>

  {{elif request.function=='responsibleedit':}}
    <h2>{{=T("Edit Responsible Entity")}}</h2>
    
    {{if record:}}
      <div class="alert alert-info">
        <h4>{{=T("Entity Info")}}</h4>
        <ul style="margin-bottom: 0;">
          <li><strong>{{=T("Context:")}} </strong>{{=context_name}}</li>
          <li><strong>{{=T("Current Participants:")}} </strong>
            <span class="badge badge-primary">{{=participant_count}}</span>
          </li>
        </ul>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading"><h3 class="panel-title">{{=T("Profile Details")}}</h3></div>
        <div class="panel-body">
          <div class="alert alert-warning">
            {{=T("Leave password blank to keep current.")}}
          </div>
          {{=form}}
        </div>
      </div>
    {{pass}}

    <div class="my-3">
      <a class="btn btn-secondary" href="{{=URL('responsiblelist')}}">
        <i class="glyphicon glyphicon-arrow-left"></i> {{=T("Back to List")}}
      </a>
    </div>

  {{elif request.function=='responsiblecreate':}}
    <h2>{{=T("Register New Responsible Entity")}}</h2>
    
    <div class="panel panel-primary">
      <div class="panel-heading"><h3 class="panel-title">{{=T("Registration")}}</h3></div>
      <div class="panel-body">
        <div class="alert alert-info">
          {{=T("Select the operational context (Microfinance, Coaching, etc.) to apply correct rules.")}}
        </div>
        {{=form}}
      </div>
    </div>

    <div class="my-3">
      <a class="btn btn-secondary" href="{{=URL('responsiblelist')}}">
        <i class="glyphicon glyphicon-arrow-left"></i> {{=T("Back to List")}}
      </a>
    </div>

  {{elif request.function in ['select', 'insert', 'update']:}}
    {{pass}}

  </div>
</div>