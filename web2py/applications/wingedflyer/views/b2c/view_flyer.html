<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{=flyer.title}} - WingedFlyer</title>
    <meta name="description" content="{{=flyer.thecontent[:150] if flyer.thecontent else ''}}...">
    
    <!-- Optimize for mobile & low bandwidth -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" 
          rel="stylesheet">
    
<style>
:root {
    --color-primary: #667eea;
    --color-bg-light: #f7fafc;
}

#content {
    width: 50vw;
    min-width: 350px;
    margin-left: auto;
    margin-right: auto;
    margin-top: calc(2em + 2vw);
    margin-bottom: calc(2em + 2vw);
    text-align: left;
}

.body-text {
    overflow-x: auto;
    font-size: 1rem;
    line-height: 1.7;
    color: #2d3748;
}

.body-text h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin: 1.5rem 0 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid var(--color-primary);
    color: #1a202c;
}

.body-text h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin: 1.25rem 0 0.75rem;
    color: #2d3748;
}

.body-text h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 1rem 0 0.5rem;
    color: #4a5568;
}

.body-text p {
    margin: 0 0 1rem;
}

.body-text img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 1rem 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.body-text code {
    background: #edf2f7;
    color: #e53e3e;
    padding: 0.2rem 0.4rem;
    border-radius: 4px;
    font-size: 0.85em;
    font-family: 'Courier New', monospace;
}

.body-text pre {
    background: #2d3748;
    color: #e2e8f0;
    padding: 0.75rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1rem 0;
}

.body-text pre code {
    background: none;
    color: inherit;
    padding: 0;
}

.body-text blockquote {
    margin: 1rem 0;
    padding: 0.85rem 1.25rem;
    background: var(--color-bg-light);
    border-left: 4px solid var(--color-primary);
    border-radius: 0 8px 8px 0;
    font-style: italic;
    color: #4a5568;
}

.body-text ul, .body-text ol {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.body-text li {
    margin-bottom: 0.5rem;
}

.body-text a {
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: border-color 0.2s;
}

.body-text a:hover {
    border-bottom-color: var(--color-primary);
}

.body-text table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
}

.body-text th, .body-text td {
    padding: 0.6rem;
    border: 1px solid #e2e8f0;
    text-align: left;
}

.body-text th {
    background: var(--color-bg-light);
    font-weight: 600;
}

.preview-meta {
    font-size: 0.9rem;
    color: #718096;
    margin-bottom: 2rem;
}

.preview-actions {
    margin-top: 2rem;
}

.preview-actions a {
    display: inline-block;
    margin-right: 1rem;
    margin-bottom: 0.5rem;
}

.preview-actions button {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.preview-actions button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.btn-qr button {
    background: #48bb78;
    color: white;
}

.btn-edit button {
    background: #718096;
    color: white;
}

/* Small mobile adjustments */
@media (max-width: 768px) {
    #content {
        width: 90vw;
        min-width: unset;
    }
    
    .body-text {
        font-size: 0.95rem;
    }
    
    .preview-actions a {
        display: block;
        margin-right: 0;
    }
    
    .preview-actions button {
        width: 100%;
    }
}
</style>
</head>
<body>
<div id="content">
    <h2>üìÑ {{=flyer.title}}</h2>
    <div class="preview-meta">
        Last updated: {{=flyer.updated_on.strftime('%B %d, %Y at %I:%M %p')}} ‚Ä¢ 
        Views: {{=flyer.view_count or 0}}
    </div>
    
    <div class="body-text">
        {{=XML(html_content)}}
    </div>

    <div class="preview-actions">
        <a href="{{=URL('b2c', 'qr', args=[flyer.id])}}" 
           class="btn-qr" target="_blank">
            <button>üì± QR Code</button>
        </a>
        
        {{if session.b2c_id and flyer.b2c_id == session.b2c_id:}}
        <a href="{{=URL('b2c', 'editor', args=[flyer.id])}}" class="btn-edit">
            <button>‚úèÔ∏è Edit in Your Library</button>
        </a>
        {{pass}}

        <p style="margin-top: 2rem; color: #718096;">
            Powered by <strong style="color: #667eea;">WingedFlyer</strong> üïäÔ∏è 
            - Making information fly to your customers
        </p>
    </div>
</div>

<script>
// Share functionality (uses Web Share API if available)
async function shareFlyer() {
    const shareData = {
        title: "{{=flyer.title.replace("'", "\\'")}}",
        text: "Check out this flyer: {{=flyer.title.replace("'", "\\'")}}",
        url: window.location.href
    };

    try {
        if (navigator.share) {
            await navigator.share(shareData);
        } else {
            await navigator.clipboard.writeText(window.location.href);
            alert('‚úÖ Link copied to clipboard!');
        }
    } catch (err) {
        prompt('Copy this link:', window.location.href);
    }
}
</script>
</body>
</html>