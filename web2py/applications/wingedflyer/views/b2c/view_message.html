{{extend 'layout.html'}}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{=URL('messages')}}">Inbox</a></li>
                <li class="breadcrumb-item active">View Message</li>
              </ol>
            </nav>
            <h2>{{=message.subject}}</h2>
            <p class="text-muted">From: {{=mfi.name}} | Received: {{=message.created_on.strftime('%B %d, %Y')}}</p>
        </div>
        <div class="col-md-4 text-right">
            <a href="{{=URL('messages')}}" class="btn btn-outline-secondary">Back to Inbox</a>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-body" style="white-space: pre-wrap; font-size: 1.1rem; line-height: 1.6;">
            {{=message.info_flyer_text}}
        </div>
    </div>

    <div class="card border-primary shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Your Response</h5>
        </div>
        <div class="card-body">
            {{if recipient_record.response:}}
                <div class="alert alert-success">
                    <strong>Submitted on {{=recipient_record.responded_on.strftime('%Y-%m-%d')}}:</strong><br>
                    {{=recipient_record.response}}
                </div>
            {{elif message.response_template == 'NONE':}}
                <p class="text-muted">No response is required for this message.</p>
            {{else:}}
                <form action="{{=URL('submit_response', args=[recipient_record.id])}}" method="post">
                    
                    {{if message.response_template == 'CHECKBOX_READ':}}
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" name="response" value="I have read and understood this message" id="confirmCheck" required>
                            <label class="form-check-label" for="confirmCheck">
                                I have read and understood this message.
                            </label>
                        </div>
                    
                    {{elif message.response_template == 'ACCEPT_DECLINE':}}
                        <div class="d-flex gap-2">
                            <button type="submit" name="response" value="ACCEPTED" class="btn btn-success px-4">Accept</button>
                            <button type="submit" name="response" value="DECLINED" class="btn btn-danger px-4">Decline</button>
                        </div>
                    
                    {{elif message.response_template == 'TEXT_RESPONSE':}}
                        <div class="form-group mb-3">
                            <textarea name="response" class="form-control" rows="4" placeholder="Type your reply here..." required></textarea>
                        </div>
                    {{pass}}

                    {{if message.response_template != 'ACCEPT_DECLINE':}}
                        <button type="submit" class="btn btn-primary">Submit Response</button>
                    {{pass}}
                </form>
            {{pass}}
        </div>
    </div>
</div>

<style>
    .card-body { color: #333; }
    .text-right { text-align: right; }
    @media (max-width: 768px) { .text-right { text-align: left; margin-top: 10px; } }
</style>
