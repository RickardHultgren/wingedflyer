{{extend 'layout.html'}}

<div class="container mt-3">
    <div class="row">
        <!-- Sidebar: User's Flyers -->
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    <h5>Your Flyers</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{{=URL('editor')}}" 
                       class="list-group-item list-group-item-action {{if not flyer_id:}}active{{pass}}">
                        â• New Flyer
                    </a>
                    {{for f in flyers:}}
                    <a href="{{=URL('editor', args=[f.id])}}" 
                       class="list-group-item list-group-item-action {{if flyer_id and str(flyer_id)==str(f.id):}}active{{pass}}">
                        {{=f.title[:30]}}{{='...' if len(f.title)>30 else ''}}
                        <br><small class="text-muted">{{=f.updated_on.strftime('%Y-%m-%d')}}</small>
                    </a>
                    {{pass}}
                </div>
            </div>
        </div>

        <!-- Main Editor -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h4>{{if current_flyer:}}Edit{{else:}}Create{{pass}} Flyer</h4>
                </div>
                <div class="card-body">
                    {{if session.flash:}}
                    <div class="alert alert-info alert-dismissible fade show">
                        {{=session.flash}}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    {{pass}}

                    <form action="{{=URL('save')}}" method="post">
                        <input type="hidden" name="flyer_id" value="{{=flyer_id or ''}}">

                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input class="form-control" name="title" 
                                   value="{{=current_flyer.title if current_flyer else ''}}"
                                   placeholder="My Flyer Title" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">
                                Content (Markdown)
                                <a href="https://www.markdownguide.org/cheat-sheet/" 
                                   target="_blank" class="small text-muted">(Guide)</a>
                            </label>
                            <textarea name="thecontent" class="form-control font-monospace" 
                                      rows="15" placeholder="# Heading&#10;Your content here..." 
                                      required>{{=current_flyer.thecontent if current_flyer else ''}}</textarea>
                        </div>

                        {{if current_flyer:}}
                        <div class="mb-3">
                            <small class="text-muted">
                                Last updated: {{=current_flyer.updated_on.strftime('%Y-%m-%d %H:%M')}}
                            </small>
                        </div>
                        {{pass}}

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                ğŸ’¾ Save
                            </button>
                            {{if current_flyer:}}
                            <a href="{{=URL('preview', args=[current_flyer.id])}}" 
                               class="btn btn-secondary">ğŸ‘ï¸ Preview</a>
                            <a href="{{=URL('view_flyer', args=[current_flyer.id])}}" 
                               class="btn btn-info" target="_blank">ğŸŒ Public View</a>
                            <a href="{{=URL('qr', args=[current_flyer.id])}}" 
                               class="btn btn-success" target="_blank">ğŸ“± QR Code</a>
                            <a href="{{=URL('delete', args=[current_flyer.id])}}" 
                               class="btn btn-danger"
                               onclick="return confirm('Delete this flyer?')">ğŸ—‘ï¸ Delete</a>
                            {{pass}}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>