{{extend 'layout.html'}}

<div class="container mt-3">
    <div class="row">
        <!-- Sidebar: User's Flyers -->
        <div class="col-md-3">
            <div class="card">
                <div class="card-header">
                    <h5>Your Flyers</h5>
                </div>
                <div class="list-group list-group-flush">
                    <!-- New Flyer -->
                    <a href="{{=URL('editor')}}" 
                       class="list-group-item list-group-item-action {{='active' if not b2c_id else ''}}">
                        â• New Flyer
                    </a>

                    <!-- List of existing flyers -->
                    {{for f in flyers:}}
                        <a href="{{=URL('editor', args=[f.id])}}" 
                           class="list-group-item list-group-item-action 
                           {{='active' if (b2c_id and str(b2c_id) == str(f.id)) else ''}}">
                            {{=f.title[:30] if f.title else 'Untitled'}}
                            {{='...' if f.title and len(f.title) > 30 else ''}}
                            <br>
                            <small class="text-muted">
                                {{=f.updated_on.strftime('%Y-%m-%d') if f.updated_on else ''}}
                            </small>
                        </a>
                    {{pass}}
                </div>
            </div>
        </div>

        <!-- Main Editor -->
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h4>{{='Edit' if current_b2c else 'Create'}} Flyer</h4>
                </div>
                <div class="card-body">

                    <!-- Flash Message -->
                    {{if session.flash:}}
                        <div class="alert alert-info alert-dismissible fade show">
                            {{=session.flash}}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {{pass}}

                    <!-- Form -->
                    <form action="{{=URL('save')}}" method="post">
                        <input type="hidden" name="b2c_id" value="{{=b2c_id or ''}}">

                        <!-- Title -->
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input class="form-control" name="title"
                                   value="{{=current_b2c.title if current_b2c else ''}}"
                                   placeholder="My Flyer Title" required>
                        </div>

                        <!-- Content -->
                        <div class="mb-3">
                            <label class="form-label">
                                Content (Markdown)
                                <a href="https://www.markdownguide.org/cheat-sheet/" 
                                   target="_blank"
                                   class="small text-muted">(Guide)</a>
                            </label>
                            <textarea name="thecontent" class="form-control font-monospace"
                                      rows="15"
                                      placeholder="# Heading&#10;Your content here..."
                                      required>{{=current_b2c.thecontent if current_b2c else ''}}</textarea>
                        </div>

                        <!-- Last Updated -->
                        {{if current_b2c and current_b2c.updated_on:}}
                            <div class="mb-3">
                                <small class="text-muted">
                                    Last updated: {{=current_b2c.updated_on.strftime('%Y-%m-%d %H:%M')}}
                                </small>
                            </div>
                        {{pass}}

                        <!-- Buttons -->
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ğŸ’¾ Save</button>

                            {{if current_b2c:}}
                                <a href="{{=URL('preview', args=[current_b2c.id])}}" 
                                   class="btn btn-secondary">ğŸ‘ï¸ Preview</a>

                                <a href="{{=URL('view_b2c', args=[current_b2c.id])}}" 
                                   class="btn btn-info" target="_blank">ğŸŒ Public View</a>

                                <a href="{{=URL('qr', args=[current_b2c.id])}}" 
                                   class="btn btn-success" target="_blank">ğŸ“± QR Code</a>

                                <a href="{{=URL('delete', args=[current_b2c.id])}}" 
                                   class="btn btn-danger"
                                   onclick="return confirm('Delete this flyer?')">ğŸ—‘ï¸ Delete</a>
                            {{pass}}
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
